  oss-security - PolicyKit: Improper handling of user with uid >  INT_MAX leading to authentication bypass            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Mon, 3 Dec From: Salvatore Bonaccorso <carnil@...ian.org> To: OSS Security Mailinglist <oss-security@...ts.openwall.com> Subject: PolicyKit: Improper handling of user with uid >  INT_MAX leading to authentication bypass  Hi  In https://gitlab.freedesktop.org/polkit/polkit/issues/74 (which got assigned by MITRE) it was reported that a user with uid > INT_MAX could successfully execute any systemctl command (but the issue is broader than that).  There is a proposed commit:  > From Mon Sep 17 > From: <zbyszek@...waw.pl> > Date: Mon, 3 Dec > Subject: [PATCH] Check gid and uid initalization in PolkitUnixUser and Group >  objects >  > When a user or group above INT32_MAX is created, the numeric uid or > gid wraps around to negative when the value is assigned to gint, and > polkit gets confused. Let's refuse such uids and gids. >  > This patch just refuses to initialize uid and gid values to negative. > A nicer fix is to change the underlying type to e.g. gint64 to allow > the full range of values in uid_t and gid_t to be represented. But > this cannot be done without breaking the API, so likely new functions > will have to be added (a polkit_unix_user_new variant that takes a > gint64, and the same for _group_new, _set_uid, _get_uid, _set_gid, > _get_gid, etc.). This will require a bigger patch. >  > Fixes https://gitlab.freedesktop.org/polkit/polkit/issues/74. >  > Example sessions from >  > Dec 03 krowka is inquiring whether is authorized for org.freedesktop.systemd1.manage-units > Dec 03 krowka  user of caller is unix-user:root > Dec 03 krowka polkit_unix_user_new: assertion 'uid >= 0' failed > Dec 03 krowka polkit_identity_to_string: assertion 'POLKIT_IS_IDENTITY (identity)' failed > Dec 03 krowka  user of subject is (null) > Dec 03 krowka polkit_identity_equal: assertion 'POLKIT_IS_IDENTITY (b)' failed > Dec 03 krowka checking whether is authorized for org.freedesktop.systemd1.manage-units > Dec 03 krowka polkit_unix_user_new: assertion 'uid >= 0' failed > Dec 03 krowka > Dec 03 krowka polkit_authorization_result_get_is_challenge: assertion 'POLKIT_IS_AUTHORIZATION_RESULT (result)' failed > Dec 03 krowka g_object_ref: assertion 'G_IS_OBJECT (object)' failed > Dec 03 krowka g_object_ref: assertion 'G_IS_OBJECT (object)' failed > Dec 03 krowka polkit_authorization_result_get_details: assertion 'POLKIT_IS_AUTHORIZATION_RESULT (result)' failed > Dec 03 krowka polkit_authorization_result_get_is_challenge: assertion 'POLKIT_IS_AUTHORIZATION_RESULT (result)' failed > Dec 03 krowka polkit_authorization_result_get_is_authorized: assertion 'POLKIT_IS_AUTHORIZATION_RESULT (result)' failed > Dec 03 krowka g_object_unref: assertion 'G_IS_OBJECT (object)' failed > Dec 03 krowka g_object_unref: assertion 'G_IS_OBJECT (object)' failed  Regards, Salvatore  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      