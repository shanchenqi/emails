  oss-security - Xen Security Advisory - x86 shadow  pagetables: address width overflow            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Mon, 18 Apr From: Xen.org security team <security@....org> To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,  xen-users@...ts.xen.org, oss-security@...ts.openwall.com CC: Xen.org security team <security@....org> Subject: Xen Security Advisory - x86 shadow  pagetables: address width overflow  -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1              Xen Security Advisory /                               version 3               x86 shadow pagetables: address width overflow  UPDATES IN VERSION 3 ====================  Public release.  ISSUE DESCRIPTION =================  In the x86 shadow pagetable code, the guest frame number of a superpage mapping is stored in a 32-bit field.  If a shadowed guest can cause a superpage mapping of a guest-physical address at or above to be shadowed, the top bits of the address will be lost, causing an assertion failure or NULL dereference later on, in code that removes the shadow.   IMPACT ======  A HVM guest using shadow pagetables can cause the host to crash.  A PV guest using shadow pagetables (i.e. being migrated) with PV superpages enabled (which is not the default) can crash the host, or corrupt hypervisor memory, and so a privilege escalation cannot be ruled out.   VULNERABLE SYSTEMS ==================  Xen versions from 3.4 onwards are affected.  Only x86 variants of Xen are susceptible.  ARM variants are not affected.  HVM guests using shadow mode paging can expose this vulnerability.  HVM guests using Hardware Assisted Paging (HAP) are unaffected.  Systems running PV guests with PV superpages enabled are vulnerable if those guests undergo live migration.  PV superpages are disabled by default, so systems are not vulnerable in this way unless "allowsuperpage" is on the Xen command line.  To discover whether your HVM guests are using HAP, or shadow page tables: request debug key `q' (from the Xen console, or with `xl debug-keys q').  This will print (to the console, and visible in `xl dmesg'), debug information for every domain, containing something like this:    (XEN) General information for domain 2:   (XEN)     refcnt=1 dying=2 pause_count=2   (XEN)     nr_pages=2 xenheap_pages=0 shared_pages=0 paged_pages=0 dirty_cpus={}   (XEN)       (XEN)     paging assistance: hap refcounts translate external                                ^^^ The presence of `hap' here indicates that the host is not vulnerable to this domain.  For an HVM domain the presence of `shadow' indicates that the domain can exploit the vulnerability.   MITIGATION ==========  Running only PV guests will avoid this vulnerability, unless PV superpage support is enabled (see above).  Running HVM guests with Hardware Assisted Paging (HAP) enabled will also avoid this vulnerability.  This is the default mode on hardware supporting HAP, but can be overridden by hypervisor command line option and guest configuration setting.  Such overrides ("hap=0" in either case, with variants like "no-hap" being possible in the hypervisor command line case) would need to be removed to avoid this vulnerability.   CREDITS =======  This issue was discovered by Ling Liu and Yihan Lian of the Cloud Security Team, Qihoo  RESOLUTION ==========  Applying the appropriate attached patch resolves this issue.   xen-unstable       Xen 4.6.x       Xen 4.5.x       Xen 4.4.x       Xen 4.3.x  $      $  DEPLOYMENT DURING EMBARGO =========================  Deployment of the patches and/or mitigations described above (or others which are substantially similar) is permitted during the embargo, even on public-facing systems with untrusted guest users and administrators.  But: Distribution of updated software is prohibited (except to other members of the predisclosure list).  Predisclosure list members who wish to deploy significantly different patches and/or mitigations, please contact the Xen Project Security Team.  (Note: this during-embargo deployment notice is retained in post-embargo publicly released Xen Project advisories, even though it is then no longer applicable.  This is to enable the community to have oversight of the Xen Project Security Team's decisionmaking.)  For more information about permissible uses of embargoed information, consult the Xen Project community's agreed Security Policy:   http://www.xenproject.org/security-policy.html -----BEGIN PGP SIGNATURE----- Version: GnuPG (GNU/Linux)  =FOR7 -----END PGP SIGNATURE-----  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      