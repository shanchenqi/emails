  oss-security - pt_chown timeline, CVE request [was: Access to /dev/pts devices via  pt_chown and user namespaces]            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [<thread-prev] [thread-next>] [day] [month] [year] [list]  Date: Sun, 28 Feb From: Jann Horn <jann@...jh.net> To: oss-security@...ts.openwall.com Cc: security@...nel.org, security@...ntu.com, security@...ian.org, 	Aurelien Jarno <aurelien@...el32.net>, 	Florian Weimer <fw@...eb.enyo.de> Subject: pt_chown timeline, CVE request [was: Access to /dev/pts devices via  pt_chown and user namespaces]  Because this can realistically lead to a privilege escalation to root, I would like to request CVE identifier allocation if that hasn't already happened.  On Tue, Feb 23, at halfdog wrote: > The logic above is severely flawed, when there can be more than one > master/slave pair having the same number and thus same name. But this > condition can be easily created by creating an user namespace, > mounting devpts with the newinstance option, create master and slave > pts pairs until the number overlaps with a target pts outside the > namespace on the host, where there is interest to gain ownership and > then invoke pt_chown. [...] > In my opinion, this security bug should be fixed two-fold: At first, > kernel should prevent the TIOCGPTN ioctl when invoked called by a > process within one namespace but acting on a filedescriptor from a > devpts instance mounted in a different namespace.  As mentioned in the private discussion about the bug (I think), that only works if you assume that there are no chroot directories with other devpts instances mounted in the init namespace or so.   > Additionally > pt_chown should check via readlink and stat, that the passed file > descriptor really was from the /dev/ptmx or /dev/pts/ptmx device > present in the same namespace as the /dev/pts/[num] device is > residing.  > This of course is only relevant if pt_chown is going to > survive on recent namespace aware systems.  As others figured out in the private bug discussion, pt_chown is already not installed as setuid binary by glibc anymore. That it is present in Debian and Ubuntu is because of a distro patch in Debian, which Debian applied to work around the bug that the "[PATCH] devpts: Sensible /dev/ptmx & force newinstance" patch is supposed to fix. So with a fix for that issue applied, Debian and Ubuntu should be able to just drop the distro patch, fixing the vuln by removing pt_chown.   > Timeline: > ========= >  >     Discovery >     Report at Ubuntu >     Report to distros list >     Patch to disable unprivileged userns due to this and > other issues LKML >     CRD and publication  I also discovered this. Let me share my timeline:  reported to security@...ian.org [some discussion] Florian Weimer suggests public disclosure I report the issue to security@...nel.org, security@...ntu.com,   security@...ian.org, Aurelien Jarno <aurelien@...el32.net>,   Florian Weimer <fw@...eb.enyo.de> and ask whether anyone can fix it until the issue is discussed and fix approaches   are considered, mostly by kernel developers, privately Parts of this land on LKML for the first time in the   "[PATCH] devpts: Sensible /dev/ptmx & force newinstance" email from   Eric W. Biederman to LKML and the participants of the private email   thread and in the following   public discussion, it's possible to see mentions of the security issue.  Download attachment "signature.asc" of type "application/pgp-signature" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      