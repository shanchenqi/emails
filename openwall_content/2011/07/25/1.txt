  oss-security - Re: CVE Request -- rpm -- Fails to remove the SUID/SGID bits on package upgrade (RH            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [<thread-prev] [thread-next>] [day] [month] [year] [list]  Date: Mon, 25 Jul From: Solar Designer <solar@...nwall.com> To: Jan Lieskovsky <jlieskov@...hat.com> Cc: oss-security <oss-security@...ts.openwall.com>, 	Panu Matilainen <pmatilai@...hat.com>, 	Jindrich Novy <jnovy@...hat.com>, Florian Festi <ffesti@...hat.com>, 	Matt McCutchen <matt@...tmccutchen.net>, 	yersinia <yersinia.spiros@...il.com> Subject: Re: CVE Request -- rpm -- Fails to remove the SUID/SGID bits on package upgrade (RH  Hi,  I know I am being a year late to comment on this, but maybe better late than never.  I'll over-quote a little bit:  On Wed, Jun 02, at Jan Lieskovsky wrote: >    Matt McCutchen pointed out a deficiency in the way rpm handled rpm  >    package upgrades -- > it failed to clear out the SUID/SGID bits of the old file by file  > replacement when privileged > user performed package upgrade. Under certain circumstances, a local,  > authenticated user could > use this flaw to escalate their privileges. >  > Red Hat Bugzilla entry: >   [1] >  > Upstream changeset: >   [2]  >   >  > Could you allocate CVE id for this?  This was assigned  And there was a similar issue 5 years earlier, affecting package removals (rather than upgrades):   That one was assigned  The descriptions and fixes for these were limited to SUID/SGID bits and fscaps (on RPM versions/builds supporting those).  However, what about device files, maybe with unsafe permissions (or just extra device files that would need to be gone on package removal or on upgrade to a package version no longer providing those)?  What about regular files with world or group write permissions, which allow for a quota bypass?  Additionally, the fix for SUID/SGID bits ignores the return value from chmod(), so it is fail-open.  It would not even print an error message. It is unclear what the best action on a partially-failed old package removal would be, but at the very least we can print an error message.  Sure, these are relatively minor issues, yet if we're fixing things, we could as well fix them more fully.  What I am considering is chmod()'ing everything but symlinks to 0, as opposed to the current fix of removing SUID/SGID bits off regular files with those bits set only.  I've attached a patch against rpm 4.2 (yes, ancient code), which passed my basic tests (but more testing is needed).  I don't care to request a third CVE id for this; I merely want to include a better fix.  I'd appreciate any comments.  Thanks,  Alexander  View attachment "rpm-4.2-owl-remove-unsafe-perms.diff" of type "text/plain" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      