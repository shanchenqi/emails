  oss-security - for pktstat: writes content from TCP streams to public  readable file /tmp/smtp.log            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Fri, 22 Feb From: Kurt Seifried <kseifried@...hat.com> To: "oss-security@...ts.openwall.com" <oss-security@...ts.openwall.com>,         sven@...nhartge.de, jari.aalto@...te.net Subject: for pktstat: writes content from TCP streams to public  readable file /tmp/smtp.log  -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1  Please use for this issue:   pktstat: writes content from TCP streams to public readable file /tmp/smtp.log   Sven Hartge <sven@...nhartge.de> reports:  Package: pktstat Version: Severity: normal Tags: security  Hi!  I noticed pktstat creates a file with a fixed name in /tmp and writes debugging info gathered from the sniffed TCP streams into it:  redacted:/tmp# ls -al smtp.log - -rw-r--r-- 1 root root Feb 22 smtp.log  Content is something like this:  - -----------8<--------------------- smpt_line [EHLO mail.example.com] normalized to [EHLO mail.example.com] set desc to: [EHLO mail.example.com] smpt_line [STARTTLS] normalized to [STARTTLS] set desc to: [STARTTLS] smpt_line [EHLO mail.example.com] normalized to [EHLO mail.example.com] set desc to: [EHLO mail.example.com] smpt_line [STARTTLS] normalized to [STARTTLS] set desc to: [STARTTLS] smpt_line [EHLO mail.example.com] normalized to [EHLO mail.example.com] set desc to: [EHLO mail.example.com] - -----------8<---------------------  This is troublesome on several levels in my opinion:  a) the filename is always the same. Since pktstat is normally run as root, this    can be used for a symlink attack, at least to overwrite important files with    garbage  b) the file is normally world readable, depending on root's umask and may contain    sensitive information.  c) if pktstat is left running for some time on a busier network interface, this    logfile can get quite big and possibly fill /tmp or /.  The code responsible is in tmp_smtp.c:  grep log * tcp_smtp.c:FILE*log; tcp_smtp.c:if ((log = fopen("/tmp/smtp.log", "a"))) tcp_smtp.c:   fprintf(log, "smpt_line [%s]\n", line); tcp_smtp.c:if (log)fprintf(log, "normalized to [%s]\n", line); tcp_smtp.c:if (log)fprintf(log, "from_addr = [%s]\n", state->from_addr); tcp_smtp.c:if (log)fprintf(log, "to_addr = [%s]\n", state->to_addr); tcp_smtp.c:if (log)fprintf(log, "set desc to: [%s]\n", f->desc); tcp_smtp.c:if (log)fclose(log);  > From the indention and formatting of said code I gather it is leftover debug code, never intended to be released.  Just removing all of the above lines is sufficient to close this bug.  Gr￼￟e, Sven.   - -- System Information: Debian Release: 7.0   APT prefers unstable   APT policy: 'unstable'), 'experimental'), 'testing') Architecture: Foreign Architectures: amd64  Kernel: Linux (SMP w/12 CPU cores) Locale: LANG=de_DE.utf8, LC_CTYPE=de_DE.utf8 (charmap=UTF-8) Shell: /bin/sh linked to /bin/dash  Versions of packages pktstat depends on: ii  libc6        ii  libncurses5  ii  libpcap0.8   ii  libtinfo5     pktstat recommends no packages.  pktstat suggests no packages.  - -- no debconf information   - --  Kurt Seifried Red Hat Security Response Team (SRT) PGP: A90B 66BF  -----BEGIN PGP SIGNATURE----- Version: GnuPG (GNU/Linux)  =5Z7R -----END PGP SIGNATURE-----  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      