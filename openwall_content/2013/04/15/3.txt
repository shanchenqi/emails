  oss-security - Xen Security Advisory 48 - qemu-nbd  format-guessing due to missing format specification            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Mon, 15 Apr From: Xen.org security team <security@....org> To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,  xen-users@...ts.xen.org, oss-security@...ts.openwall.com CC: Xen.org security team <security@....org> Subject: Xen Security Advisory 48 - qemu-nbd  format-guessing due to missing format specification  -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1  	     Xen Security Advisory / XSA-48 			      version 2           qemu-nbd format-guessing due to missing format specification  UPDATES IN VERSION 2 ====================  Public release.  ISSUE DESCRIPTION =================  The qemu-nbd tool (shipped in the Xen hypervisor tools distribution as qemu-nbd-xen) autodetects the image format.  If a particular disk image is intended to be raw, a guest operating system administrator could write a header to the image, describing another format than original one.  This could lead to a scenario in which after restart of that guest, qemu-nbd would detect the new apparent format of the image, including a specified backing file or device, which could allow the guest to read any file on the host.  IMPACT ======  qemu-nbd (qemu-nbd-xen) is not used by the toolstack software supplied with the Xen tree.  However, it is built and installed, and so might be used by host administrators or by toolstacks other than libxl or xend.  If qemu-nbd is used, a malicious guest administrator may be able to read any file on the host, depending exactly how.  VULNERABLE SYSTEMS ==================  For Xen systems using libxl (xl) or xend (xm): if neither qemu-nbd-xen nor qemu-nbd (since qemu-nbd-xen is installed under the latter name in /usr/lib/xen/bin) is explicitly invoked by scripts or other software not supplied by the Xen project, the system is not vulnerable.  Xen systems using other toolstacks may be vulnerable if those toolstacks use qemu-nbd[-xen].  A guest administrator who runs qemu-nbd-xen by hand on a guest may be exposing themselves to this vulnerability.  Only qemu-xen-upstream is vulnerable; qemu-xen-traditional has a fix which makes this bug not apply.  However, the Xen build system builds and installs both by default, in some arbitrary order, to the same filename.  So which is installed and might be used is not predictable unless the qemu-xen-upstream build is entirely disabled.  Only systems with Xen 4.2 and later installed are vulnerable (by virtue of the presence of Xen) as earlier versions of Xen do not build qemu-xen-upstream at all.  MITIGATION ==========  No mitigation is available for users of qemu-nbd[-xen].  If you are using qemu-nbd[-xen] from qemu-xen-upstream on raw image files, then arranging to use qemu-xen-traditional instead will fail.  If you wish enhanced assurance, removing all copies of of qemu-nbd and qemu-nbd-xen will provide confidence that this vulnerable utility is not being used.  RESOLUTION ==========  To resolve the problem, it is necessary to apply the attached patch (to the qemu-xen-upstream tree).  It is ALSO NECESSARY to ensure that all invocations of qemu-nbd are provided with an appropriate -f (--format) option.  Invoking qemu-nbd without this option remains unsafe and the patch does not prevent it.          Xen 4.2.x (Xen's qemu-upstream-4.2-testing.git) xsa48-unstable.patch    Xen unstable (Xen's qemu-upstream-unstable.git)  $ xsa48*   xsa48-unstable.patch $ -----BEGIN PGP SIGNATURE----- Version: GnuPG (GNU/Linux)  =Nel4 -----END PGP SIGNATURE-----  Download attachment of type "application/octet-stream" bytes)  Download attachment "xsa48-unstable.patch" of type "application/octet-stream" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      