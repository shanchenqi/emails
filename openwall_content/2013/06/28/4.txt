  oss-security - general Krb5 DNS vulnerabilities (e.g. krb5 web auth)? [was: Re: CVE request: rpc-gssd is vulnerable to DNS spoofing]            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [<thread-prev] [day] [month] [year] [list]  Date: Fri, 28 Jun From: Daniel Kahn Gillmor <dkg@...thhorseman.net> To: Kurt Seifried <kseifried@...hat.com>, oss-security@...ts.openwall.com Cc: Vincent Danen <vdanen@...hat.com>, Ghe Rivero <ghe@...ian.org>, Mike Hommey <glandium@...ian.org> Subject: general Krb5 DNS vulnerabilities (e.g. krb5 web auth)? [was: Re: CVE request: rpc-gssd is vulnerable to DNS spoofing]  On Thu Kurt Seifried wrote:  > On PM, Vincent Danen wrote: >> This has been discussed on the linux-nfs mailing list, so fully >> public. Just cutting and pasting from our bugzilla: >>  >> It was reported [1],[2] that rpc.gssd in nfs-utils is vulnerable to >> DNS spoofing due to it depending on PTR resolution for GSSAPI  >> authentication.  Because of this, if a user where able to poison >> DNS to a victim's computer, they would be able to trick rpc.gssd >> into talking to another server (perhaps with less security) than >> the intended server (with stricter security).  If the victim has >> write access to the second (less secure) server, and the attacker >> has read access (when they normally might not on the secure >> server), the victim could write files to that server, which the >> attacker could obtain (when normally they would not be able to). >> To the victim this is transparent because the victim's computer >> asks the KDC for a ticket to the second server due to reverse DNS >> resolution; in this case Krb5 authentication does not fail because >> the victim is talking to the "correct" server. >>  >> A patch that prevents this issue has been posted [3]. >>  >> To workaround this issue, set the IP/host pair in /etc/hosts so >> that it cannot be spoofed. >>  >> A good explanation is also available here [4]. >>  >> [1] [2] >> [3] >> [4] >> >>  >>  >> >>  >>  >> Since this is fairly new, I don't think a CVE would have been >> requested already.  Could one be assigned to this? > > Please use for this issue.  I'm wondering if this isn't actually a larger issue, outside of NFS. For example, when i use SPNEGO/Negotiate authentication in a firefox/iceweasel browser to foo.example.com, firefox appears to normalize the request via a DNS reverse lookup before requesting a krb5 ticket.  ------------------------- 0 dkg@...ce:~$ klist Ticket cache: Default principal: dkg@...MPLE.COM  Valid starting    Expires           Service principal   krbtgt/EXAMPLE.COM@...MPLE.COM 	renew until 0 dkg@...ce:~$    [ then i point my browser (debian iceweasel maintainer Cc'ed    here) at http://foo.example.com/login, which does WWW Negotiate    authentication, but the PTR record refers to bar.example.com ]  0 dkg@...ce:~$ klist Ticket cache: Default principal: dkg@...MPLE.COM  Valid starting    Expires           Service principal   krbtgt/EXAMPLE.COM@...MPLE.COM 	renew until   HTTP/bar.example.com@ 	renew until   HTTP/bar.example.com@...MPLE.COM 	renew until 0 dkg@...ce:~$  -------------------------   On the server side, using debian's libapache2-mod-kerb (maintainer cc'ed as well), apache does a reverse lookup on its own virtualhost name (confirmed by observing traffic with tcpdump).  So it seems like the same argument used above for NFS applies to the web/negotiate/spnego/gssapi/krb5 use case: an attacker capable of poisoning the DNS and intercepting traffic could make an authenticated victim do something on server A while thinking that they were manipulating server B, based on their kerberos credentials.  Is it possible that this is a bigger problem that needs to be addressed at the krb5 level?  iirc, reverse DNS has traditionally been a known point of concern for krb5 deployments, but maybe the specific attacks just haven't been explicitly articulated or identified as a problem?  I might also be confused; feel free to point me to corrective material.    --dkg  Content of type "application/pgp-signature" skipped  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      