  oss-security - Re: CVE Request: More perf security fixes            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [<thread-prev] [thread-next>] [day] [month] [year] [list]  Date: Wed, 5 Jun From: Andi Kleen <ak@...ux.jf.intel.com> To: Peter Zijlstra <peterz@...radead.org> Cc: Andi Kleen <ak@...ux.jf.intel.com>, Marcus Meissner <meissner@...e.de>,         OSS Security List <oss-security@...ts.openwall.com>,         eranian@...gle.com, security@...nel.org Subject: Re: CVE Request: More perf security fixes  On Wed, Jun 05, at Peter Zijlstra wrote: > On Tue, Jun 04, at Andi Kleen wrote: > > > 3. Information leak (??) via perf LBR filter  > >  > > Leak + crash actually. > >  > > >  > > > > > >  > > > commit > > > Author: Peter Zijlstra <a.p.zijlstra@...llo.nl> > > > Date:   Fri May 3 > > >  > > >     perf/x86/intel/lbr: Fix LBR filter > > >      > > >     The LBR 'from' adddress is under full userspace control; ensure > > >     we validate it before reading from it. > >  > > This patch is known broken and causes additional crashes. > > There's no updated patch for that so far. >  > And yet there's no crash report in my inbox.. how kind you you andi.  It was brand new. Normally we only report when we knew more.  I just posted it here to stop people from releasing buggy updates.  >  > And I know you don't agree with the patch, but since you're too lazy to > provide a better one I didn't think you minded _that_ much :-)  It has nothing to do with the old performance problem  (the patch adding a O(n^2) performance path)  We found recently a correctness problem during some stress testing. It seems to be a latent bug in the module list handling.  Under some conditions the module list walk from the NMI handler crashes.  Strangely it even happens under normal operation, you don't even need to load/unload a module.  Here's an example oops (unfortunately with a lot of junk)  [  ? [  ? [  ? [  ? [  ? [  [<c26bbfbf>] ? [  [<c26bbfbf>] ? [  ? [mperf] [  ? [  ? [  [<c26bbfbf>] ? [  ? [mperf] [  ? [  ? [  ? [mperf] [  ? [mperf] [  ? [mperf] [  ? [mperf] [  ? [  ? [  ? [  ? [mperf] [  ? [mperf] [  ? [mperf] [  ? [  ? [  ? [mperf] [  ? [  ? [  ? [  ? [  ? [  ? [  ? [mperf] [  ? [  ? [  [<c26baedb>] ? [  ? [  ?  struct module *__module_address(unsigned long addr) {         struct module *mod;          if (addr < module_addr_min || addr > module_addr_max)                 return NULL;          list_for_each_entry_rcu(mod, &modules, list) {                 if (mod->state == MODULE_STATE_UNFORMED)                 ^^^^^^^ trigger page fault ^^^^^^^                         continue;                 if (within_module_core(addr, mod)                     || within_module_init(addr, mod))                         return mod;         }         return NULL; }    -Andi     --  ak@...ux.intel.com -- Speaking for myself only  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      