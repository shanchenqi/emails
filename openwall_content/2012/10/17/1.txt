  oss-security - CVE request: Fwd: [Full-disclosure] SEC Consult :: ModSecurity multipart/invalid part ruleset bypass            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [thread-next>] [day] [month] [year] [list]  Date: Wed, 17 Oct From: Matthias Weckbecker <mweckbecker@...e.de> To: oss-security@...ts.openwall.com Subject: CVE request: Fwd: [Full-disclosure] SEC Consult :: ModSecurity multipart/invalid part ruleset bypass  Hi Steve, Kurt, vendors,  this flaw looks slightly different from the last one and apparently has not got a CVE yet.   ----------  Forwarded Message  ----------  Subject: [Full-disclosure] SEC Consult :: ModSecurity  multipart/invalid part ruleset bypass Date: Wednesday 17 October From: SEC Consult Vulnerability Lab <research@...-consult.com> To: full-disclosure@...ts.grok.org.uk, bugtraq@...urityfocus.com  SEC Consult Vulnerability Lab Security Advisory < > =======================================================================               title: ModSecurity multipart/invalid part ruleset bypass             product: ModSecurity  vulnerable version: <=       fixed version:          CVE number: -              impact: Depends what you use it for            homepage: http://www.modsecurity.org/               found:                  by: Bernhard Mueller                      SEC Consult Vulnerability Lab                      https://www.sec-consult.com =======================================================================  Vendor/product description: --------------------------- ModSecurity for Apache is a web server plug-in for the Apache web server platform. This is the original, most mature and deployed ModSecurity module. This module is maintained by the Trustwave SpiderLabs Research Team.  URL: http://www.modsecurity.org/projects/modsecurity/apache/   Vulnerability overview/description: ----------------------------------- Validation of POST parameters can be bypassed on Apache/PHP installations by sending specially formed multipart requests. A POST parameter's content can be hidden from ModSecurity by prepending an invalid part. This first part contains only a Content-Disposition header and has an additional carriage return inserted at the end of the line ([\r\r\n]). This is followed by a boundary in the next line and another Content-Disposition header with a filename. The request content looks like this (newlines are all \r\n except in line 2).  --A Content-Disposition: form-data; name="id"[\r][\r][\n] --A Content-Disposition: form-data; name="lol"; filename="x"  1 UNION SELECT  --A--  ModSecurity skips what it believes to be an invalid first part and proceeds to parse the second part. This part is treated as a file and not checked against the ruleset.  PHP however treats the whole thing as a single part and processes only the first Content-Disposition header, ignoring the second one. In the opinion of PHP this request contains a POST parameter with the name specified in the first header.   Proof of concept: -----------------  wut.php: --------  <? echo $POST[xxx] ?>   POST request: -------------  POST /wut.php HTTP/1.1 Content-Type: multipart/form-data; boundary=A Content-Length:  --A Content-Disposition: form-data; name="xxx"[\r][\r][\n] --A Content-Disposition: form-data; name="yyy"; filename="z"  1 UNION SELECT  --A--   Output: -------  1 UNION SELECT  (any change in the header should produce a   Vulnerable / tested versions: -----------------------------  This works with ModSecurity up to version   Vendor contact timeline: ------------------------ Contacted ModSecurity ModSecurity guys fixed it New ModSecurity release Public release of advisory   Solution: --------- To mitigate this bypass method, upgrade to ModSecurity and make sure that the MULTIPART_INVALID_PART flag is set in the multipart strict validation rule. Add the line:  IQ %{MULTIPART_INVALID_PART}, \  to the SecRule MULTIPART_STRICT_ERROR in your ModSecurity configuration file.  Download is available at:  http://www.modsecurity.org/download/    Advisory URL: -------------- https://www.sec-consult.com/en/advisories.html   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ The SEC Consult Group  Office Vienna Mooslackengasse 17 Vienna Austria Tel.: +43 / 1 / 30 43 - 0 Fax.: +43 / 1 / 30 43 - 25 Mail: research at sec-consult dot com www.sec-consult.com   Office Singapore 4 Battery Road Bank of China Building Singapore Mail: office at sec-consult dot sg   Check out our blog at: http://blog.sec-consult.com/   And this thing here: http://wordpress.org/extend/plugins/mvis-security-center/   EOF B. Mueller / October  _______________________________________________ Full-Disclosure - We believe in it. Charter: http://lists.grok.org.uk/full-disclosure-charter.html Hosted and sponsored by Secunia - http://secunia.com/  -------------------------------------------------------  --  Matthias Weckbecker, Senior Security Engineer, SUSE Security Team SUSE LINUX Products GmbH, Maxfeldstr. 5, Nuernberg, Germany Tel:  http://suse.com/ SUSE LINUX Products GmbH, GF: Jeff Hawn, HRB (AG Nuernberg)   Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      