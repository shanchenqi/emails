  oss-security - [SECURITY ADVISORY] curl: overwrite local file with -J            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Wed, 24 Jun (CEST) From: Daniel Stenberg <daniel@...x.se> To: curl security announcements -- curl users <curl-users@...l.haxx.se>,         curl-announce@...l.haxx.se,         libcurl hacking <curl-library@...l.haxx.se>,         oss-security@...ts.openwall.com Subject: [SECURITY ADVISORY] curl: overwrite local file with -J  curl overwrite local file with -J =================================  Project curl Security Advisory, June 24th -  VULNERABILITY -------------  curl can be tricked my a malicious server to overwrite a local file when using `-J` (`--remote-header-name`) and `-i` (`--head`) in the same command line.  The command line tool offers the `-J` option that saves a remote file using the file name present in the `Content-Disposition:` response header. curl then refuses to overwrite an existing local file using the same name, if one already exists in the current directory.  The `-J` flag is designed to save a response body, and so it doesn't work together with `-i` and there's logic that forbids it. However, the check is flawed and doesn't properly check for when the options are used in the reversed order: first using `-J` and then `-i` were mistakenly accepted.  The result of this mistake was that incoming HTTP headers could overwrite a local file if one existed, as the check to avoid the local file was done first when body data was received, and due to the mistake mentioned above, it could already have received and saved headers by that time.  The saved file would only get response headers added to it, as it would abort the saving when the first body byte arrives. A malicious server could however still be made to send back virtually anything as headers and curl would save them like this, until the first CRLF-CRLF sequence appears.  (Also note that `-J` needs to be used in combination with `-O` to have any effect.)  We are not aware of any exploit of this flaw.  INFO ----  Users should be aware and *never* run curl with the `-J` option in their `$HOME` or other sensitive directories, independently of this flaw. Using curl that way allows curl to create any file name it likes (i.e. what the remote server suggests) and it can confuse or trick users if allowed to save files that can mistakenly be assumed to be "locally made" or part of the system rather than provided by a potentially malicious remote party.  This bug was brought in commit when `-J` was introduced to curl, first shipped in curl  This flaw can happen to users of the curl tool but **not** for applications using libcurl.  The Common Vulnerabilities and Exposures (CVE) project has assigned the name to this issue.  Improper Restriction of Names for Files and Other Resources  Severity: 4.7 (Medium)  AFFECTED VERSIONS -----------------  - Affected versions: curl to and including - Not affected versions: curl < and curl >=  THE SOLUTION ------------  A [fix for  RECOMMENDATIONS --------------  We suggest you take one of the following actions immediately, in order of preference:    A - Upgrade curl to version    B - Apply the patch on your curl version and rebuild    C - Do not use `-J` (in a directory with pre-existing files)  TIMELINE --------  This issue was first reported to the curl project on May 30,  This advisory was posted on June 24th  CREDITS -------  This issue was reported by sn on hackerone. Patched by Daniel Stenberg.  Thanks a lot!  --     / daniel.haxx.se | Commercial curl support up to is available!                    | Private help, bug fixes, support, ports, new features                    | https://www.wolfssl.com/contact/  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      