  oss-security - xawtv: v4l-conf setuid-root program allows file  existence tests and open(..., O_RDRW) on arbitrary files            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Thu, 4 Jun From: Matthias Gerstner <mgerstner@...e.de> To: oss-security@...ts.openwall.com Subject: xawtv: v4l-conf setuid-root program allows file  existence tests and open(..., O_RDRW) on arbitrary files  Hallo,  xawtv [1] contains a setuid-root program called `v4l-conf` that is supposed to allow regular users to configure v4l devices. xawtv is pretty old code but it is stilled shipped on some distributions like Debian and openSUSE.  Vulnerability Description =========================  While checking the source code of `v4l-conf` I noticed that it allows regular users to perform arbitrary file existence tests and also to perform `open(..., O_RDWR)` and `fstat()` system calls on arbitrary files. The issue is found in the `dev_open()` function which only contains a naive security check:  ```     if (strncmp(device, "/dev/", 5)) { 	fprintf(stderr, "error: %s is not a /dev file\n", device); 	exit(1);     } ```  This check is not safe against relative path components or symlinks in /dev/shm. Example:  ``` # in this case the file does not exist user $ v4l-conf -c /dev/../root/.bashrc VT_GETSTATE is not supported: Inappropriate ioctl for device mode: 0x0, depth=0, bpp=0, bpl=0, base=unknown can't open /dev/../root/.bashrc: No such file or directory  # in this case the file exists user $ v4l-conf -c /dev/../root/.bash_history VT_GETSTATE is not supported: Inappropriate ioctl for device mode: 0x0, depth=0, bpp=0, bpl=0, base=unknown /dev/../root/.bash_history: wrong device ```  Some devices in /dev might also trigger code paths upon open() in the kernel that are usually not reachable to regular users.  Bugfix ======  Upstream added two fixes in their Git repository [2]:  - commit - commit  The fix is still incomplete though. It avoids to perform an `open()` on unintended files. But it still allows the file existence test to be performed. Attached is a small patch that fixes also that.  Timeline ========  I privately reported the finding to             mchehab+samsung@...nel.org, one of the xawtv maintainers 	    denoted in [3]. - various discussions with the maintainer about             the fix. He published the partial fixes in the Git 	    repository right away.  I reported to the maintainer that the fix is still             incomplete but did not hear back since then.  I requested and obtained a CVE from Mitre for this issue.  [1]: https://www.linuxtv.org/wiki/index.php/Xawtv [2]: https://git.linuxtv.org/xawtv3.git [3]: https://www.linuxtv.org/wiki/index.php/Media_Maintainers#XawTV  Cheers  Matthias  --  Matthias Gerstner <matthias.gerstner@...e.de> Dipl.-Wirtsch.-Inf. (FH), Security Engineer https://www.suse.com/security Phone: +49 53 GPG Key ID:  SUSE Software Solutions Germany GmbH HRB AG Nürnberg Geschäftsführer: Felix Imendörffer   View attachment of type "text/x-diff" bytes)  Download attachment "signature.asc" of type "application/pgp-signature" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      