  oss-security - Xen Security Advisory v2 - undue deferral of IOMMU TLB flushes            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Tue, 20 Oct From: Xen.org security team <security@....org> To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,  xen-users@...ts.xen.org, oss-security@...ts.openwall.com CC: Xen.org security team <security-team-members@....org> Subject: Xen Security Advisory v2 - undue deferral of IOMMU TLB flushes  -----BEGIN PGP SIGNED MESSAGE----- Hash:                      Xen Security Advisory                               version 2                    undue deferral of IOMMU TLB flushes  UPDATES IN VERSION 2 ====================  Public release.  ISSUE DESCRIPTION =================  To efficiently change the physical to machine address mappings of a larger range of addresses for fully virtualized guests, Xen contains an optimization to coalesce per-page IOMMU TLB flushes into a single, wider flush after all adjustments have been made.  While this is fine to do for newly introduced page mappings, the possible removal of pages from such guests during this operation should not be "optimized" in the same way.  This is because the (typically) final reference of such pages is dropped before the coalesced flush, and hence the pages may have been put to a different use even though DMA initiated by their original owner mightstill be in progress.  IMPACT ======  A malicious guest might be able to cause data corruption and data leaks.  Host or guest Denial of Service (DoS), and privilege escalation, cannot be ruled out.  VULNERABLE SYSTEMS ==================  All Xen versions from 4.2 onwards are vulnerable.  Xen versions 4.1 and earlier are not vulnerable.  Only x86 HVM and PVH guests can leverage the vulnerability.  Arm guests as well as x86 PV ones cannot leverage the vulnerability.  Only x86 HVM and PVH guests which have physical devices passed through to them can leverage the vulnerability.  Only x86 HVM and PVH guests configured to not share IOMMU and CPU page tables can leverage the vulnerability.  Sharing these page tables is the default on capable Intel (VT-d) hardware.  On AMD hardware sharing is not possible.  On Intel (VT-d) hardware sharing may also not be possible, depending on hardware properties.  Whether it is possible can be seen from the presence (or absence) of "iommu_hap_pt_share" on the "virt_caps" line of "xl info" output.  Guests run in shadow mode can leverage the vulnerability.  MITIGATION ==========  Not passing through physical devices to untrusted guests will avoid the vulnerability.  On systems permitting page table sharing, not suppressing use of the functionality will allow to avoid the vulnerability. This means guests should not be run in * shadow mode, i.e. hardware needs to be HAP (Hardware Assisted Paging)   capable, there should not be "hap=0" in the guest's xl configuration   file, and there should not be "hap=0" or equivalent on Xen's command   line, * non-shared page table mode, i.e. hardware needs to be capable of   sharing, there should not be "passthrough=sync_pt" in the guest's xl   configuration file, and there should not be "iommu=no-sharept" or   equivalent on Xen's command line.  CREDITS =======  This issue was discovered by Jan Beulich of SUSE.  RESOLUTION ==========  Applying the appropriate pair of attached patches resolves this issue.  Note that patches for released versions are generally prepared to apply to the stable branches, and may not apply cleanly to the most recent release tarball.  Downstreams are encouraged to update to the tip of the stable branch before applying these patches.            Xen - xen-unstable      Xen      Xen      Xen      Xen  $            $  DEPLOYMENT DURING EMBARGO =========================  Deployment of the patches described above (or others which are substantially similar) is permitted during the embargo, even on public-facing systems with untrusted guest users and administrators.  HOWEVER, deployment of the mitigations is NOT permitted (except where all the affected systems and VMs are administered and used only by organisations which are members of the Xen Project Security Issues Predisclosure List).  Specifically, deployment on public cloud systems is NOT permitted.  This is because removal of pass-through devices or their replacement by emulated devices is a guest visible configuration change, which may lead to re-discovery of the issue.  Similarly the possible guest configuration changes can't be excluded to be noticeable to guests.  Deployment of this mitigation is permitted only AFTER the embargo ends.  AND: Distribution of updated software is prohibited (except to other members of the predisclosure list).  Predisclosure list members who wish to deploy significantly different patches and/or mitigations, please contact the Xen Project Security Team.  (Note: this during-embargo deployment notice is retained in post-embargo publicly released Xen Project advisories, even though it is then no longer applicable.  This is to enable the community to have oversight of the Xen Project Security Team's decisionmaking.)  For more information about permissible uses of embargoed information, consult the Xen Project community's agreed Security Policy:   http://www.xenproject.org/security-policy.html -----BEGIN PGP SIGNATURE-----  =2aos -----END PGP SIGNATURE-----  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      