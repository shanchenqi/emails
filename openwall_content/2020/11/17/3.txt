  oss-security - ceph: CEPHX_V2 replay attack protection lost            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [thread-next>] [day] [month] [year] [list]  Date: Tue, 17 Nov From: Ana McTaggart <amctagga@...hat.com> To: Ilya Dryomov <idryomov@...hat.com>, oss-security@...ts.openwall.com Subject: ceph: CEPHX_V2 replay attack protection lost  Dear all, cephx authentication protocol does not verify ceph clients correctly, and is vulnerable to replay attacks in nautilus and later. An attacker with access to the Ceph cluster network can use this vulnerability to authenticate with ceph service, via a packet sniffer. This allows them to perform actions allowed by the ceph service. This is a reintroduction of affecting msgr2 protocol. msgr 2 protocol is used for all communication except for older clients that do not support msgr2 protocol. msgr1 protocol is not affected.  This was introduced in commit to msgr2 ("mon/MonClient: skip CEPHX_V2 challenge if client doesn't support it") , due to commit ("msg/async/ProtocolV1: use AuthServer and AuthClient") . This results in nautilus and ceph being affected because commit wasn't backported to nautilus, and although msgr1 isn't affected in nautilus, msgr 2 is the default. This made it so authorizer challenges could be skipped for peers which did not support CEPHX_V2, unfortunately making it so authorizer challenges are skipped for all peers in both msgr 1 and msgr2 cases, disabling the protection that was put in place in commit ("auth/cephx: add authorizer challenge",  Proposed Patch: See attached.  We have assigned it a CVE of at Red Hat.  Credits to Ilya Dryomov   Ana McTaggart  Red Hat Product Security  Red Hat Remote <https://www.redhat.com>   secalert@...hat.com for urgent response   amct@...hat.com   M:     IM: amctagga   Pronouns:They/Them/Theirs  Content of type "text/html" skipped  Download attachment of type "application/x-patch" bytes)  Download attachment of type "application/x-patch" bytes)  Download attachment of type "application/x-patch" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      