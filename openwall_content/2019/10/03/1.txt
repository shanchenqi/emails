  oss-security - Re: QEMU-KVM Guest to Host Kernel Escape  Vulnerability: vhost/vhost_net kernel buffer overflow            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [<thread-prev] [thread-next>] [day] [month] [year] [list]  Date: Thu, 3 Oct From: Tina Li <tli@...italocean.com> To: oss-security@...ts.openwall.com, peterpi@...cent.com Cc: Vineeth Remanan Pillai <vpillai@...italocean.com> Subject: Re: QEMU-KVM Guest to Host Kernel Escape  Vulnerability: vhost/vhost_net kernel buffer overflow  Hi Peter,  We are trying to follow your steps to reproduce the attack.  Our host is Ubuntu LTS.  Guest is installed with Ubuntu LTS, and we have built the kernel with attached patches and install the built kernel.  Initially, we were using QEMU 4.1. After running  the echo command to trigger the bug, the guest kernel crashes every time.  Here is the crash stack trace:  [  kernel BUG at  [  invalid opcode: [#1] SMP PTI  [  Modules linked in: kvm_intel kvm irqbypass input_leds joydev serio_raw ib_iser mac_hid i2c_piix4 rdma_cm iw_cm ib_cm ib_core configfs iscsi_tcp libiscsi_tcp libiscsi scsi_transport_iscsi autofs4 btrfs zstd_decompress zstd_compress xxhash raid10 async_raid6_recov async_memcpy async_pq async_xor async_tx xor raid6_pq libcrc32c raid1 raid0 multipath linear qxl ttm drm_kms_helper crct10dif_pclmul crc32_pclmul ghash_clmulni_intel pcbc syscopyarea sysfillrect sysimgblt fb_sys_fops drm aesni_intel pata_acpi crypto_simd glue_helper psmouse cryptd virtio_net virtio_scsi floppy  [  CPU: 1 PID: 16 Comm: ksoftirqd/1 Not tainted #1  [  Hardware name:  [  RIP:  [  RSP: EFLAGS:  [  RAX: RBX: RCX:  [  RDX: RSI: RDI:  [  RBP: R08: R09:  [  R10: R11: R12:  [  R13: R14: R15:  [  FS:   [  CS:  DS: ES: CR0:  [  CR2: CR3: CR4:  [  DR0: DR1: DR2:  [  DR3: DR6: DR7:  [  PKRU:  [  Call Trace:  [    [   [virtio_net]  [   ?  [    [    [    [    [    [   ?  [   ?  [    [  Code: ff 49 c7 87 98 00 00 00 00 00 00 00 eb 10 4d 85 e4 74 0b 49 8b 87 98 00 00 00 49 89 04 24 5b 5d 41 5c 41 5d 41 5e 41 5f c3 0f 0b <0f> 0b 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 44 00 00 8b 47 38 55  [  RIP: RSP:  [  ---[ end trace ]---  [  Kernel panic - not syncing: Fatal exception in interrupt  [  Kernel Offset: from (relocation range:  [  ---[ end Kernel panic - not syncing: Fatal exception in interrupt  Setting _vq->indirect when *ctx is non-NULL might be leading to BUG_ON() at a later point  =>                   BUG_ON(!(vq->vring.desc[head].flags &                            cpu_to_virtio16(vq->vq.vdev, VRING_DESC_F_INDIRECT)));  Then we revert QEMU to and re-do the test. In this scenario, the guest kernel does not crash always, but we are unable to reproduce the host crash during live migrate.  Please let us know if there is something missing in our test that is causing the crash? Also, would be great if you could share more of your environment details like Host OS/kernel, qemu version etc. Thanks a lot!   Best regards,  Tianlin   Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      