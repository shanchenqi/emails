  oss-security - Linux kernel: powerpc: kernel crash in TM handling  triggerable by any local user            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Tue, 30 Jul From: Michael Neuling <mikey@...ling.org> To: oss-security@...ts.openwall.com Cc: linuxppc-dev@...ts.ozlabs.org, linux-kernel@...r.kernel.org,  Linuxppc-users <linuxppc-users@...ts.ozlabs.org>, Michael Ellerman  <michael@...erman.id.au> Subject: Linux kernel: powerpc: kernel crash in TM handling  triggerable by any local user  The Linux kernel for powerpc since v3.9 has a bug in the TM handling  where any unprivileged local user may crash the operating system.  This bug affects machines using 64-bit CPUs where Transactional Memory (TM) is not present or has been disabled (see below for more details on affected CPUs).  To trigger the bug a process constructs a signal context which still has the MSR TS bits set. That process then passes this signal context to the sigreturn() system call. When returning back to userspace, the kernel then crashes with a bad TM transition (TM Bad Thing) or by executing TM code on a non-TM system.  All 64bit machines where TM is not present are affected. This includes PowerPC (G5), PA6T, VMs under KVM or LPARs under PowerVM and POWER9 bare metal.   Additionally systems with TM hardware but where TM is disabled in software (via ppc_tm=off kernel cmdline) are also affected. This includes POWER8/9 VMs under KVM or LPARs under PowerVM and POWER8 bare metal.  The bug was introduced in commit:   ("powerpc: Add new transactional memory state to the signal context")  Which was originally merged in v3.9.   The upstream fix is here:    The fix can be verified by running `sigfuz -m` from the kernel selftests:  https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/tools/testing/selftests/powerpc/signal/sigfuz.c?h=v5.2  cheers Mikey   Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      