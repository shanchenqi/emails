  oss-security - Re: QEMU-KVM Guest to Host Kernel Escape  Vulnerability: vhost/vhost_net kernel buffer overflow            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Tue, 24 Sep From: peterpi(皮罡) <peterpi@...cent.com> To: "oss-security@...ts.openwall.com" <oss-security@...ts.openwall.com>, 	cradminzhang(张博) <cradminzhang@...cent.com> Subject: Re: QEMU-KVM Guest to Host Kernel Escape  Vulnerability: vhost/vhost_net kernel buffer overflow  Reproduce method of with Ubuntu and virt-manager.  The reproduce method will hit the log buffer overflow in function get_indirect and crash the host kernel. We will use virt-manager to do live migrate. If you have your own live migrate method, then you only need the "setup guest" step, then trigger live migrate to test the bug.  Two Hosts: A local host installed Ubuntu LTS with [your target kernel] and with virt-manager installed, and can create and start a QEMU-KVM VM by virt-manager. And a remote host with same setup (no need latest mainline stable kernel) for live migrate. Guest: Create a Ubuntu LTS guest by virt-manager on local host.  We will setup virt-manager live migrate connection, and setup the guest kernel with indirect desc table, then trigger live migrate by virt-manager, local host kernel will be crashed. It seems virt-manger will use vhost/vhost_net as default virtio network backend on my environment.  1> Connect to remote host for live migrate Start virt-manager on local host by : sudo virt-manager --no-fork After using --no-fork, you can add connection to remote host using SSH. In the virt-manager main window, select File -> Add Connection -> Connect to remote host (Method: SSH, Username : [remote host ssh login username], Hostname : [remote host IP]) Click connect, then in the "sudo virt-manager --no-fork" shell will let you to input SSH login password.   2> setup guest After connected to remote host, you can start your guest to setup it. Start guest, virt-manager will new a VM window to start your guest vm.  In guest, I cloned Linux kernel from ubuntu kernel source git(git://kernel.ubuntu.com/ubuntu/ubuntu-xenial.git) according to ubuntu wiki. And "git checkout Build the kernel with attached patches and install the built kernel.  In the guest with built kernel, do below steps:  find /sys -name "*mergeable*" echo > modprobe -r virtio_net modprobe  virtio_net   3> Trigger live migrate In the virt-manager VM window, select Virtual Machine -> Migrate -> if the "Address" field displays remote host machine name, change it to remote host IP. When start migrate, it will cause local host kernel crash after some seconds.  Peter Pi of Tencent Blade Team  Content of type "text/html" skipped  Download attachment "poc_guest_virtio_ring.diff" of type "application/octet-stream" bytes)  Download attachment "poc_guest_virtio_net.diff" of type "application/octet-stream" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      