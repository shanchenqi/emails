  oss-security - Linux kernel: powerpc: missing Spectre-RSB mitigation            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Thu, 28 Nov From: Michael Ellerman <mpe@...erman.id.au> To: oss-security@...ts.openwall.com Subject: Linux kernel: powerpc: missing Spectre-RSB mitigation  The Linux kernel for powerpc fails to activate the mitigation for Spectre-RSB (Return Stack Buffer, aka. ret2spec) on context switch, on CPUs prior to Power9 DD2.3.  This allows a process to poison the RSB (called Link Stack on Power CPUs) and possibly misdirect speculative execution of another process. If the victim process can be induced to execute a leak gadget then it may be possible to extract information from the victim via a side channel.  Mitigation for Spectre-RSB was introduced in commit:   (âpowerpc/64s: Add support for software count cache flushâ)  Which was originally merged in  However that commit incorrectly tied the code to flush the link stack to a firmware feature which is only enabled on newer CPUs (P9N DD2.3 or later), when it should have been applied to all CPUs that are affected by Spectre v2.  The fix is to enable the link stack flush on all CPUs that have any mitigation of Spectre v2 in userspace enabled.  This issue is assigned  CVSS 3.1 Score: 5.6 AV:L/AC:H/PR:L/UI:N/S:C/C:H/I:N/A:N  This issue was discovered by Anthony Steinhauser of Google's Safeside Project.  Additionally we have determined that when returning from a guest, there is the possibility that poisoned values on the link stack could be used by function returns in the host kernel. To mitigate this we have added a flush of the link stack in the guest exit path.  The fix is in mainline as:    And the KVM fix is:    Both will be released in  There's a test case attached, extracted from Google's safeside project. It can be built with:   $ g++ -O2 -Wall -std=c++11 -m64 -o ret2spec_recursion_ca ret2spec_recursion_ca.cc  Output on an unpatched system:   $ ./ret2spec_recursion_ca   Leaking the string: It's a s3kr3t!!!   16 bytes successfully leaked   FAIL! Was able to leak the secret  vs patched:   $ ./ret2spec_recursion_ca   Leaking the string: ????????????????   0 bytes successfully leaked   PASS! Unable to leak the secret  cheers   View attachment "ret2spec_recursion_ca.cc" of type "text/plain" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      