  oss-security - Re: MySQL / MariaDB / Percona - Root Privilege  Escalation Exploit [ / ]            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [<thread-prev] [thread-next>] [day] [month] [year] [list]  Date: Fri, 17 Feb From: Dawid Golunski <dawid@...alhackers.com> To: Tomas Hoger <thoger@...hat.com> Cc: oss-security@...ts.openwall.com Subject: Re: MySQL / MariaDB / Percona - Root Privilege  Escalation Exploit [ / ]  Hi Tomas,  Yes, I have reported the insufficient fixes to Oracle and related vendors.  I wanted to allow some more time for patching before making these public. I will make my advisories and exploits public soon.  Thanks.   On Fri, Feb 17, at AM, Tomas Hoger <thoger@...hat.com> wrote: > On Mon, 14 Nov Dawid Golunski wrote: > >> Vulnerability: MySQL / MariaDB / PerconaDB - Root Privilege Escalation >> / > > The original MySQL fix for this issue was quite incomplete and easy to > bypass.  It had the following problems: > > - Symlink check was racy - it was easy to replace log file created by >   touch by a symlink before chmod and chown was used. > > - You could avoid the symlink check completely by directly setting >   log-error to the path name of the file you want to corrupt, such as: > >   log-error = /etc/ld.so.preload > > - Symlink check did not cover hardlinks (this is a variant of the >   previous, sort of). > > - Existing symlinks were used even if they were not chmoded / chowned >   any more, so it was possible to corrupt files with myslqd_safe's log >   messages. > > I reported these problems to Oracle, and they assigned > for the incomplete fix.  They were addressed in the following commit: > > > > Note that the commit pre-dates Oct CPU, when Oracle first > mentioned / as fixed, but it was only > included in MySQL and released mid-Dec and > hence listed in Jan CPU.  The fix also pre-dates my report. > > Dawid, I assume you were aware of these problems and reported them > too.  You're acknowledged as a reporter of (at least) one of the issues > in the Jan CPU: > > > > and also in Percona Server release notes: > > > >   mysqld_safe now limits the use of rm and chown to avoid privilege >   escalation. chown can now be used only for /var/log directory. Bug >   fixed Thanks to Dawid Golunski (https://legalhackers.com). > > Linked Percona bug is not public, but the above text matches MySQL > commit linked above. > > As Oracle is refusing to publicly share any information about their > CVEs, can you, Dawid, provide information on what CVE or CVEs were > given to you by Oracle in response to your reports, and for what > issues?  If you've not received that information yet, would you mind > asking?  I suspect you may have some info to share on and > > > > Besides the above, I also reported the following issues.  CVEs below > were assigned by Oracle. > > > unsafe chmod/chown use in the init script > > > > > These may allow mysql -> root privilege escalation similar to >  Fixed in: > > > > > was assigned to two independent issues > > - unrestricted mysqld_safe's ledir > > By setting ledir to say /tmp in my.cnf, you could make mysqld_safe > execute mysqld from there rather than some expected location > under /usr.  Besides mysql -> root escalation, this also could have > been used by non-mysql local users in combination with the > issue against MySQL versions that do not support > malloc-lib (e.g. MySQL 5.1).  Fixed in: > > > > - insecure path use in mysqld_safe > > This code tries to find my_print_defaults command: > > > > It first tries relative to $MY_BASEDIR_VERSION, which could have been > set to $PWD: > > > > If root ran mysqld_safe while their $PWD was /tmp, arbitrary code > controlled by some unprivileged local (not necessarily mysql) user > could have been executed.  This was fixed in: > > > > > There are few more related problems fixed in Jan CPU, but as noted > above, Oracle refuses to acknowledge mapping to CVEs publicly. > > > > > -- > Tomas Hoger / Red Hat Product Security    --  Regards, Dawid Golunski https://legalhackers.com t: @dawid_golunski  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      