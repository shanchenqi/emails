  oss-security - - Claymore's Dual Ethereum Miner unauth stack buffer overflow in remote management interface            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Mon, 4 Dec From: "oststrom \(public\)" <pub@...strom.com> To: <oss-security@...ts.openwall.com> Subject: - Claymore's Dual Ethereum Miner unauth stack buffer overflow in remote management interface  VuNote ===================    Author:       <github.com/tintinweb>   Ref:      Version:      0.2   Date:         Nov 30th,    Tag:          claymore dual ethereum decred crypto currency miner  Overview --------    Name:         Claymore's Dual ETH + DCR/SC/LBC/PASC GPU Miner   Vendor:       nanopool/claymore   References:   * https://github.com/nanopool/Claymore-Dual-Miner                 *    Version:        [2]   Latest Version: [2]   Other Versions: <=   Platform(s):    windows, linux   Technology:     C/C++    Vuln Classes:   Stack-based Buffer Overflow   Origin:         remote   Min. Privs.:    None    Source:         Closed; runtime protection mechanisms    CVE:               Description ---------  A specialized mining solution with remote management interface for mining ethereum / decred / siacoin / LBRY Credits / pascal coin.  quote website [1][2]    - Supports new "dual mining" mode: mining both Ethereum and Decred/Siacoin/Lbry/Pascal at the same time, with no impact on Ethereum mining speed. Ethereum-only mining mode is supported as well.   - Effective Ethereum mining speed is higher by 3-5% because of a completely different miner code - much less invalid and outdated shares, higher GPU load, optimized OpenCL code, optimized assembler kernels.   - Supports both AMD and nVidia cards, even mixed.   - No DAG files.   - Supports all Stratum versions for Ethereum: can be used directly without any proxies with all pools that support eth-proxy, qtminer or miner-proxy.   - Supports Ethereum and Siacoin solo mining.   - Supports both HTTP and Stratum for Decred.   - Supports both HTTP and Stratum for Siacoin. Note: not all Stratum versions are supported currently for Siacoin.   - Supports Stratum for Lbry and Pascal.   - Supports failover.   - Displays detailed mining information and hashrate for every card.   - Supports remote monitoring and management.   - Supports GPU selection, built-in GPU overclocking features and temperature management.   - Supports Ethereum forks (Expanse, etc).   - Windows and Linux versions.  Summary -------  Claymore's Dual ETH miner's remote management interface is prone to an unauthenticated remote stack buffer overwrite that can be triggered by simply sending an overly long api request to the management interface resulting in an unbound `(v)sprintf` style buffer overwrite when trying to log to file or console.   * unauthenticated * remote * stack buffer overwrite  conditions: * remote management must be enabled: -mport <port> * also works in read-only mode (-<port>)  Successful exploitation can be turned into: * DoS - taking profit from crashing the miner * RCE - execute arbitrary code, silently take over the mining node or host system.  See PoC ref github.  //Also see: - Claymore's Dual ETH Miner relative path traversal in remote management interface [4] //For details see ref github.  Details -------  Service Discovery: * shodan: 'eth result' lists about publicly available instances [3] with significant hash power * banner:   <html><body style="font-family: monospace;"> {"result": - ETH", "off;off;off;off;off", management: read-only mode, command miner_file ignored </font><br><font - SHARE FOUND - (GPU 3) ...   Remote Management API overview:  # >nc -L -p ed>"]} "1"]} "0"]} "2"]} ed>"]} ed>"]}   EthDcrMiner64 comes with an optional http/tcp based remote management interface that can be enabled by providing `-mport <[-]port>` as a command line argument. Providing a negative port starts the remote management interface in readonly mode. The remote management interfaces request handler checks for a list of known commands (see Remote Management API overview). Commands are being logged to file. When the handler encounters an invalid command a logline like `log(level, "Remote management: unknown command %s\n", request)` is being emitted. This method internally calls `sprintf` multiple times writing to a fixed size buffer of bytes. Any attempt to log more than bytes us causing a stack buffer overwrite. There's likely multiple occurrences of the same bug within this software.  //see PoC vector: method, extrafield, psw  See PoC ref github.  Proof of Concept ----------------  Prerequisites: * compatible AMD/NVidia hardware   RCE:  1. start the miner, specify any pool and the readonly management port with a management password   #> EthDcrMiner64.exe -epool -mport  +----------------------------------------------------------------+ |     Claymore's Dual ETH + DCR/SC/LBC/PASC GPU Miner      | +----------------------------------------------------------------+  ... Total cards: 1 ETH - connecting to DUAL MINING MODE ENABLED: ETHEREUM+DECRED DCR: Stratum - connecting to 'pasc-eu2.nanopool.org' port ETH: HTTP SOLO mode Ethereum HTTP requests time (-etht) is set to ms Watchdog enabled Remote management (READ-ONLY MODE) is enabled on port  DCR: Stratum - Connected DCR: Authorized DCR: - New job from      2. wait for it to initialize     3. run `poc.py --vector=method (using the "method" vector)  #> poc.py [poc.py -             <module>() ][    INFO] --start-- [poc.py -             <module>() ][    INFO] # Claymore's Dual ETH + DCR/SC/LBC/PASC GPU Miner - Remote Buffer Overwrite [poc.py -             <module>() ][    INFO] # github.com/tintinweb [poc.py -         iter_targets() ][ WARNING] shodan apikey missing! shodan support disabled. [poc.py -             <module>() ][    INFO] [i] Target: [poc.py -             <module>() ][    INFO] [+] connected. [poc.py -             <module>() ][    INFO] [+] peer disappeared. vulnerable! [poc.py -             <module>() ][ WARNING] 'Eine vorhandene Verbindung wurde vom Remotehost geschlossen') [poc.py -             <module>() ][    INFO] --done--   4. EthDcrMiner64.exe faults with `INVALID_POINTER_WRITE_EXPLOITABLE` (stack overwrite, see stacktrace)   GPU0 t=57C fan=0% Remote management: unknown command miner_getstat1 aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa .... <crash>   WinDBG:  %< %< see ref github link. >% >%  Patch -----  n/A - closed source  Notes -----  * Timeline  - vendor contact: report sent - vendor response:              fixed version ready and publicly available              request for 7+ day embargo - public disclosure  * Vendor Changelog  Fixed version:   References ----------  [1] https://github.com/nanopool/Claymore-Dual-Miner [2] [3] https://www.shodan.io/search?query=eth+result [4]  Contact -------  https://github.com/tintinweb    Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      