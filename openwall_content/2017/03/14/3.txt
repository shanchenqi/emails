  oss-security - Xen Security Advisory - Cirrus VGA Heap  overflow via display refresh            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Tue, 14 Mar From: Xen.org security team <security@....org> To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,  xen-users@...ts.xen.org, oss-security@...ts.openwall.com CC: Xen.org security team <security@....org> Subject: Xen Security Advisory - Cirrus VGA Heap  overflow via display refresh  -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1              Xen Security Advisory /                               version 2               Cirrus VGA Heap overflow via display refresh  UPDATES IN VERSION 2 ====================  Patches for qemu-xen-traditional.  Public release.  ISSUE DESCRIPTION =================  When a graphics update command gets passed to the VGA emulator, there are 3 possible modes that can be used to update the display:  * blank - Clears the display * text - Treats the display as showing text * graph - Treats the display as showing graphics  After the display geometry gets changed (i.e., after the CIRRUS VGA emulation has resized the display), the VGA emulator will resize the console during the next update command. However, when a blank mode is also selected during an update, this resize doesn't happen. The resize will be properly handled during the next time a non-blank mode is selected during an update.  However, other console components - such as the VNC emulation - will operate as though this resize had happened. When the display is resized to be larger than before, this can result in a heap overflow as console components will expect the display buffer to be larger than it is currently allocated.  IMPACT ======  A privileged user within the guest VM can cause a heap overflow in the device model process, potentially escalating their privileges to that of the device model process.  VULNERABLE SYSTEMS ==================  All versions of Xen are vulnerable.  Only HVM guests with the Cirrus video card are vulnerable.  (The Cirrus video card is the default.)  Both qemu-upstream and qemu-traditional are vulnerable.  For HVM guests with the device model running in a stub domain, "the privileges of the device model process" are identical to those of the guest kernel.  But the ability of a userspace process to trigger this vulnerability via legitimate commands to the kernel driver (thus elevating its privileges to that of the guest kernel) cannot be ruled out.  MITIGATION ==========  Running only PV guests, or running HVM guests with the stgvga driver, will avoid this vulnerability.  Running HVM guests with stub domains will mitigate the vulnerability to at most a guest kernel privilege escalation.  CREDITS =======  The discoverer of this issue requested to remain anonymous.  RESOLUTION ==========  Applying the appropriate attached patch resolves this issue (and any further bitblit vulnerabilities) by disabling the bitblit functionality from the Cirrus VGA device entirely.      qemu-upstream master qemu-upstream 4.8 qemu-upstream 4.7 qemu-upstream 4.6 and 4.5 qemu-upstream 4.4     qemu-xen-traditional 4.6 and later qemu-xen-traditional 4.4 and 4.5  $        $  NOTE REGARDING EMBARGO ======================  The embargo period is much shorter than our standard two-week period. This is at the request of the discoverer.  DEPLOYMENT DURING EMBARGO =========================  Deployment of the patches and/or the mitigation of running with an HVM stub domain (or others which are substantially similar) is permitted during the embargo, even on public-facing systems with untrusted guest users and administrators.  It is NOT permitted during the embargo to switch from Cirrus VGA to Stdvga on public-facing systems with untrusted guest users or administrators.  This is because it may give a clue where the issue lies.  This mitigation is only permitted AFTER the embargo ends.  As always, distribution of updated software is prohibited (except to other members of the predisclosure list).  Predisclosure list members who wish to deploy significantly different patches and/or mitigations, please contact the Xen Project Security Team.  (Note: this during-embargo deployment notice is retained in post-embargo publicly released Xen Project advisories, even though it is then no longer applicable.  This is to enable the community to have oversight of the Xen Project Security Team's decisionmaking.)  For more information about permissible uses of embargoed information, consult the Xen Project community's agreed Security Policy:   http://www.xenproject.org/security-policy.html -----BEGIN PGP SIGNATURE----- Version: GnuPG v1  =wLoq -----END PGP SIGNATURE-----  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      