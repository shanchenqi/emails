  oss-security - LDAP with useTLS option disabled TLS peer verification             Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [thread-next>] [day] [month] [year] [list]  Date: Wed, 19 Jul From: Graham Christensen <graham@...hamc.com> To: oss-security@...ts.openwall.com Subject: LDAP with useTLS option disabled TLS peer verification    Hello,  Attached is a NixOS security advisory. It is part of a greater security-related effort within the NixOS community. It is signed by me, a member of the NixOS security team (https://nixos.org/nixos/security.html).  As we are a growing community, and as we grow our security-focused efforts, we would like to ultimately seek membership in the distro list. We do not meet the requirements at this time, in particular the private build infrastructure. However, in an effort to improve to our process, I would be interested in the community's feedback on our advisory format.  Note we are still working to file for a CVE on this issue.  Although I accidentally left out a link to the original issue in this one, all subsequent advisories will include issue links.   -----BEGIN PGP SIGNED MESSAGE----- Hash:                            Nix Security Advisory                                                                                     ---------------------             LDAP with useTLS disabled TLS peer verification   Description ===========  The users.ldap NixOS module implements user authentication against LDAP servers via a PAM module. It was found that if TLS is enabled to connect to the LDAP server with users.ldap.useTLS, peer verification will be unconditionally disabled in /etc/ldap.conf.   Impact ======  A man-in-the-middle attack can be performed by an attacker between a machine with enabled LDAP authentication and the LDAP server. Even though TLS is enabled an attacker is able to impersonate the LDAP server with an invalid certificate.  Attackers might be able to steal user password hashes or service account credentials in plaintext.   Vulnerable Systems ==================  NixOS and earlier releases are unsupported and vulnerable.    Distribution            First Non-Vulnerable Commit   ------------            ---------------------------                 nixos-unstable             Channel                 First Non-Vulnerable Release   -------                 ----------------------------                       expected within 3 hours   nixos-unstable-small    unknown   nixos-unstable          unknown   Mitigation ==========  Option A:  Set users.ldap.useTLS to false, and manually specify TLS in the extraConfig:      {      users.ldap.useTLS = false;      users.ldap.extraConfig = ''        ssl start_tls      '';    }  Option B:  Switch your NixOS channel to update, and nixos-rebuild switch:    # nix-channel --add nixos   # nix-channel --update   # nixos-rebuild switch   Resolution ==========  NixOS now does not add "tls_checkpeer no" to the LDAP configuration when users.ldap.useTLS is enabled. Users who need this behavior can add it back via the users.ldap.extraConfig option. -----BEGIN PGP SIGNATURE-----  =YvT+ -----END PGP SIGNATURE-----  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      