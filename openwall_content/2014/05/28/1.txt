  oss-security - LSE Leading Security Experts GmbH - - Check_MK - Arbitrary  File Disclosure Vulnerability            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Wed, 28 May From: "LSE Leading Security Experts GmbH (Security Advisories)" <advisories@...xperts.de> To: bugtraq@...urityfocus.com Cc: oss-security@...ts.openwall.com, fulldisclosure@...lists.org, 	bugs@...uritytracker.com Subject: LSE Leading Security Experts GmbH - - Check_MK - Arbitrary  File Disclosure Vulnerability   -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1  === LSE Leading Security Experts GmbH - Security Advisory ===  Check_MK - Arbitrary File Disclosure Vulnerability - --------------------------------------------------  Affected Versions ================= Linux versions of Check_MK equal or greater than commit until Release  Other platforms are not affected as the vulnerable feature is not implemented there.  Issue Overview ============== Technical Risk: high Likelihood of Exploitation: high Vendor: Mathias Kettner GmbH Credits: LSE Leading Security Experts GmbH employees   Markus Vervier and Sascha Kettler Advisory URL: Advisory Status: Public CVE-Number:  Issue Description ================= While conducting a whitebox test LSE Leading Security Experts GmbH discovered that the Check_MK agent processes files from a directory with mode It is not checked if the files are symbolic or hard filesystem links.  As the Check_MK agent runs with root permissions by default, it will read arbitrary files and readable devices with root permissions.  The directory mode was introduced on Sep 5 in commit  <<>> commit Author: Bernd Stroessenreuther <bs@...hias-kettner.de> Date:   Thu Sep 5      mk-job: /var/lib/check_mk_agent/job directory is now     created with mode so mk-job can be used by     unprivileged users too: fixing bug <<>>  The vulnerable code in the agent for reading job results from "/var/lib/check_mk_agent/job" is:  <<>> # Get statistics about monitored jobs if cd /var/lib/check_mk_agent/job; then     echo '<<<job>>>'     head -n -0 -v * fi <<>>  Impact ====== A local user may create a symbolic link in the directory "/var/lib/check_mk_agent/job", pointing to a file he normally would not have access to like "/etc/shadow". The agent expects output from jobs using the mk-job Tool in that directory. It will output the content of all files in the directory on TCP port by default.  Temporary Workaround and Fix ============================ LSE Leading Security Experts GmbH advises to remove the write permissions and the sticky bit for non root users temporarily by setting mode on the directory.  Proof of Concept ================     [myhost]$ pwd     /var/lib/check_mk_agent/job     [myhost]$ ls -l     total 0     [myhost]$ ln -s /etc/shadow     [myhost]$ ls -la     total 4     drwxrwxrwt 2 root   root    May 21 .     drwxr-xr-x 3 root   root    Feb 26 ..     lrwxrwxrwx 1 myuser mygroup   11 May 21 shadow -> /etc/shadow     [myhost]$ nc     [...]     <<<job>>>     ==> shadow <==                                                                 [...]  History =======  Issue discovery  Permission of customer for advisory  Vendor informed  CVE requested  Vendor response  assigned  Official fix available  Advisory release  - --  http://www.lsexperts.de LSE Leading Security Experts GmbH, Postfach Darmstadt Tel.: +49 (0) Fax: Unternehmenssitz: Weiterstadt, Amtsgericht Darmstadt: Geschäftsführer: Oliver Michel, Sven Walther -----BEGIN PGP SIGNATURE----- Version: GnuPG (FreeBSD)  =rbLP -----END PGP SIGNATURE-----   Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      