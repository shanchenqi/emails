  oss-security - Xen Security Advisory 90 - Linux netback crash  trying to disable due to malformed packet            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Wed, 02 Apr From: Xen.org security team <security@....org> To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,  xen-users@...ts.xen.org, oss-security@...ts.openwall.com CC: Xen.org security team <security@....org> Subject: Xen Security Advisory 90 - Linux netback crash  trying to disable due to malformed packet  -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1               Xen Security Advisory / XSA-90                               version 2        Linux netback crash trying to disable due to malformed packet  UPDATES IN VERSION 2 ====================  This issue has been assigned  A fix has been accepted into the Linux network subsystem maintainer's tree.  The final fix differs substantially from the initial patch, which calls xenvif_carrier_off from an invalid context resulting in a kernel panic in the backend.  The updated patch defers this work to kthread context and ensures that no traffic is processed in the meantime.  The attached patches have been updated accordingly.  Since the patch in v1 of the advisory does not eliminate the vulnerability, users are strongly encouraged to update to the latest patch.  ISSUE DESCRIPTION =================  When Linux's netback sees a malformed packet, it tries to disable the interface which serves the misbehaving frontend.  This involves taking a mutex, which might sleep.  But in recent versions of Linux the guest transmit path is handled by NAPI in softirq context, where sleeping is not allowed.  The end result is that the backend domain (often, Dom0) crashes with "scheduling while atomic".  IMPACT ======  Malicious guest administrators can cause denial of service.  If driver domains are not in use, the impact is a host crash.  VULNERABLE SYSTEMS ==================  This bug affects systems using Linux as the driver domain, including non-disaggregated systems using Linux as dom0.  Only versions of Linux whose netback uses NAPI are affected.  In Linux mainline this is all versions of Linux containing git changeset which was introduced between Linux and  Systems using a different OS as dom0 (eg, NetBSD, Solaris) are not vulnerable.  Both x86 and ARM systems are affected.  MITIGATION ==========  Using driver domains may limit the scope of the denial of service, and may make it possible to resume service without restarting guests (by restarting the driver domain).  Advice on reconfiguring a system to use driver domains is beyond the reasonable scope of this advisory.  In the case of an x86 HVM guest, the exploit can be prevented by disabling the PV IO paths; normally this would come with a substantial performance cost, and it may involve reconfiguring the guest as well as the host.  This is not recommended.  NOTE REGARDING LACK OF EMBARGO ==============================  This bug was publicly reported on xen-devel, before it was appreciated that there was a security problem.  The public mailing list thread nevertheless contains information strongly suggestive of a security bug, and a different security bug (with CVE) is suggested as seeming "similar".  For these reasons we (the Xen Project Security Team) have concluded that the presence of this bug, as a security problem, is not (any longer) a secret.  CREDITS =======  This issue was discovered as a bug by Tรถrรถk Edwin and analysed by Wei Liu of Citrix.  RESOLUTION ==========  Applying the attached patch resolves this issue.  $ xsa90*.patch  xsa90.patch $  This patch has also been applied to the network subsystem maintainer's git tree: -----BEGIN PGP SIGNATURE----- Version: GnuPG (GNU/Linux)  =FL5w -----END PGP SIGNATURE-----  Download attachment "xsa90.patch" of type "application/octet-stream" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      