  oss-security - [PATCH 2/4] Revert "oom: deprecate oom_adj tunable"            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [<thread-prev] [thread-next>] [day] [month] [year] [list]  Date: Thu, 16 Sep (JST) From: KOSAKI Motohiro <kosaki.motohiro@...fujitsu.com> To: Linus Torvalds <torvalds@...ux-foundation.org> Cc: kosaki.motohiro@...fujitsu.com, Andrew Morton <akpm@...ux-foundation.org>,         linux-kernel@...r.kernel.org, oss-security@...ts.openwall.com,         Solar Designer <solar@...nwall.com>,         Kees Cook <kees.cook@...onical.com>, Al Viro <viro@...iv.linux.org.uk>,         Oleg Nesterov <oleg@...hat.com>, Neil Horman <nhorman@...driver.com>,         linux-fsdevel@...r.kernel.org, pageexec@...email.hu,         Brad Spengler <spender@...ecurity.net>, Eugene Teo <eugene@...hat.com>,         KAMEZAWA Hiroyuki <kamezawa.hiroyu@...fujitsu.com>,         linux-mm <linux-mm@...ck.org>, David Rientjes <rientjes@...gle.com> Subject: [PATCH 2/4] Revert "oom: deprecate oom_adj tunable"  oom_adj is not only used for kernel knob, but also used for application interface. Then, adding new knob is no good reason to deprecate it.  Also, after former patch, oom_score_adj can't be used for setting OOM_DISABLE. We need "echo -17 > /proc/<pid>/oom_adj" thing.  This reverts commit ---  Documentation/feature-removal-schedule.txt |   25 -------------------------  Documentation/filesystems/proc.txt         |    3 ---  fs/proc/base.c                             |    8 --------  include/linux/oom.h                        |    3 ---  4 files changed, 0 insertions(+), 39 deletions(-)  diff --git a/Documentation/feature-removal-schedule.txt b/Documentation/feature-removal-schedule.txt index --- a/Documentation/feature-removal-schedule.txt +++ b/Documentation/feature-removal-schedule.txt @@ @@ Who:	Eric Biederman <ebiederm@...ssion.com>    ---------------------------   -What:	/proc/<pid>/oom_adj -When:	August -Why:	/proc/<pid>/oom_adj allows userspace to influence the oom killer's -	badness heuristic used to determine which task to kill when the kernel -	is out of memory. - -	The badness heuristic has since been rewritten since the introduction of -	this tunable such that its meaning is deprecated.  The value was -	implemented as a bitshift on a score generated by the badness() -	function that did not have any precise units of measure.  With the -	rewrite, the score is given as a proportion of available memory to the -	task allocating pages, so using a bitshift which grows the score -	exponentially is, thus, impossible to tune with fine granularity. - -	A much more powerful interface, /proc/<pid>/oom_score_adj, was -	introduced with the oom killer rewrite that allows users to increase or -	decrease the badness() score linearly.  This interface will replace -	/proc/<pid>/oom_adj. - -	A warning will be emitted to the kernel log if an application uses this -	deprecated interface.  After it is printed once, future warnings will be -	suppressed until the kernel is rebooted. - ---------------------------- -  What:	remove EXPORT_SYMBOL(kernel_thread)  When:	August  Files:	arch/*/kernel/*_ksyms.c diff --git a/Documentation/filesystems/proc.txt b/Documentation/filesystems/proc.txt index --- a/Documentation/filesystems/proc.txt +++ b/Documentation/filesystems/proc.txt @@ @@ scaled linearly with /proc/<pid>/oom_score_adj.  Writing to /proc/<pid>/oom_score_adj or /proc/<pid>/oom_adj will change the  other with its scaled value.   -NOTICE: /proc/<pid>/oom_adj is deprecated and will be removed, please see -Documentation/feature-removal-schedule.txt. -  Caveat: when a parent task is selected, the oom killer will sacrifice any first  generation children with seperate address spaces instead, if possible.  This  avoids servers and important system daemons from being killed and loses the diff --git a/fs/proc/base.c b/fs/proc/base.c index --- a/fs/proc/base.c +++ b/fs/proc/base.c @@ @@ static ssize_t oom_adjust_write(struct file *file, const char __user *buf,  		return -EACCES;  	}   -	/* -	 * Warn that /proc/pid/oom_adj is deprecated, see -	 * Documentation/feature-removal-schedule.txt. -	 */ -	printk_once(KERN_WARNING "%s (%d): /proc/%d/oom_adj is deprecated, " -			"please use /proc/%d/oom_score_adj instead.\n", -			current->comm, task_pid_nr(current), -			task_pid_nr(task), task_pid_nr(task));  	task->signal->oom_adj = oom_adjust;    	unlock_task_sighand(task, &flags); diff --git a/include/linux/oom.h b/include/linux/oom.h index --- a/include/linux/oom.h +++ b/include/linux/oom.h @@ -2,9 +2,6 @@  #define __INCLUDE_LINUX_OOM_H    /* - * /proc/<pid>/oom_adj is deprecated, see - * Documentation/feature-removal-schedule.txt. - *   * /proc/<pid>/oom_adj set to -17 protects from the oom-killer   */  #define OOM_DISABLE (-17) --      Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      