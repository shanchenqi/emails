  oss-security - [CVE Request/Advisory] Multiple vulnerabilities in PHP's handling of  Phar files            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Mon, 18 May From: Emmanuel Law <emmanuel.law@...il.com> To: oss-security@...ts.openwall.com, cve-assign@...re.org Cc: security@....net Subject: [CVE Request/Advisory] Multiple vulnerabilities in PHP's handling of  Phar files  Hi  --------Background--------- PHP has the built-in Phar & PharData functionality since It allows developers to use them to manipulate the following archive types: tar, zip, phar. Serveral vulnerabilities were found in the Phar extenion.    [1: CVE Request - Memory Corruption in phar_parse_tarfile when entry filename starts with null ]  Description: ------------ This is a single byte memory corruption vulnerability. It is triggered when a tar entry->filename starts with a null byte. On a x86 machine, it has the potential to corrupt the heap chunk metadata.On x64 machine, it has the potential to corrupt 1 byte at the offset entry.filename+0xFFFFFFFF Affected versions: PHP <= Bug Report: Patch:  Can a CVE be assign for this please?   [2: - Heap metadata corruption when parsing tar file in phar_tar_process_metadata()] Description: ------------ This is a vulnerability whereby the Heap header gets misaligned resulting in the corruption of the heap chunk's metadata. A heap chunk is allocated in metadata = (char *) safe_emalloc(1, entry->uncompressed_filesize, 1); A reference to this heap chunk is passed into phar_parse_metadata() at if (phar_parse_metadata(&metadata, &entry->metadata, entry->uncompressed_filesize TSRMLS_CC) == FAILURE) { The following gets called within when zip_metadata_len==0 PHAR_GET_32(*buffer, buf_len); This moves the pointer referencing the heap chunk by 4bytes. When the heap chunk gets freeed at at efree(metadata); The heap chunk is now misaligned by 4 bytes. In otherwords: ZEND_MM_HEADER_OF(metadata).info._size is now ZEND_MM_HEADER_OF(metadata).info._prev and ZEND_MM_HEADER_OF(metadata).info._prev is tained with the body's data. Affected versions: PHP <= Bug Report: Patch: This patch was for but it inadvertently resolved this vulnerability as well. The vulnerable line that was removed was on  PHAR_GET_32(*buffer, buf_len);    Thanks.   Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      