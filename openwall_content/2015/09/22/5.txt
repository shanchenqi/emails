  oss-security - Xen Security Advisory - libxl fails to honour  readonly flag on disks with qemu-xen            Products  Openwall GNU/*/Linux   server OS Linux Kernel Runtime Guard John the Ripper   password cracker  Free & Open Source for any platform in the cloud Pro for Linux Pro for macOS  Wordlists   for password cracking passwdqc   policy enforcement  Free & Open Source for Unix Pro for Windows (Active Directory)  yescrypt   KDF & password hashing yespower   Proof-of-Work (PoW) crypt_blowfish   password hashing phpass   ditto in PHP tcb   better password shadowing Pluggable Authentication Modules scanlogd   port scan detector popa3d   tiny POP3 daemon blists   web interface to mailing lists msulogin   single user mode login php_mt_seed   mt_rand() cracker  Services Publications  Articles Presentations  Resources  Mailing lists Community wiki Source code repositories (GitHub) Source code repositories (CVSweb) File archive & mirrors How to verify digital signatures OVE IDs  What's new         Follow @Openwall on Twitter for new release announcements and other news   [<prev] [next>] [day] [month] [year] [list]  Date: Tue, 22 Sep From: Xen.org security team <security@....org> To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,  xen-users@...ts.xen.org, oss-security@...ts.openwall.com CC: Xen.org security team <security@....org> Subject: Xen Security Advisory - libxl fails to honour  readonly flag on disks with qemu-xen  -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1              Xen Security Advisory /                               version 2          libxl fails to honour readonly flag on disks with qemu-xen  UPDATES IN VERSION 2 ====================  CVE assigned.  ISSUE DESCRIPTION =================  Callers of libxl can specify that a disk should be read-only to the guest.  However, there is no code in libxl to pass this information to qemu-xen (the upstream-based qemu); and indeed there is no way in qemu to make a disk read-only.  The vulnerability is exploitable only via devices emulated by the device model, not the parallel PV devices for supporting PVHVM. Normally the PVHVM device unplug protocol renders the emulated devices inaccessible early in boot.  IMPACT ======  Malicious guest administrators or (in some situations) users may be able to write to supposedly read-only disk images.  CDROM devices (that is, devices specified to be presented to the guest as CDROMs, regardless of the nature of the backing storage on the host) are not affected.  VULNERABLE SYSTEMS ==================  Only systems using qemu-xen (rather than qemu-xen-traditional) as the device model version are vulnerable.  Only systems using libxl or libxl-based toolstacks are vulnerable. (This includes xl, and libvirt with the libxl driver.)  All versions of libxl which support qemu-xen are vulnerable.  The affected code was introduced in Xen 4.1.  If the host and guest together usually support PVHVM, the issue is exploitable only if the malicious guest administrator has control of the guest kernel or guest kernel command line.  MITIGATION ==========  Switching to qemu-xen-traditional will avoid this vulnerability. This can be done with    device_model_version="qemu-xen-traditional" in the xl configuration file.  Using stub domain device models (which necessarily involves switching to qemu-xen-traditional) will also avoid this vulnerability. This can be done with    device_model_stubdomain_override=true in the xl configuration file.  Either of these mitigations is liable to have other guest-visible effects or even regressions.  It may be possible, depending on the configuration, to make the underlying storage object readonly, or to make it reject writes.  RESOLUTION ==========  There is no reasonable resolution because Qemu does not (at the time of writing) support presenting a read-only block device to a guest as a disk.  The attached patch corrects the weakness in the libxl code, by rejecting the unsupported configurations, rather than allowing them to run but with the device perhaps writeable by the guest.  Applying it should increase confidence and avoid future configuration errors, but will break affected configurations specifying read-only disk devices.                  Xen 4.6.x and later                 Xen 4.3.x to 4.5.x inclusive  $   $  NOTE REGARDING LACK OF EMBARGO ==============================  This issue was discussed in public in the Red Hat bugzilla:    CREDITS =======  Thanks to Michael Young of Durham University for bring this problem to our attention.  -----BEGIN PGP SIGNATURE----- Version: GnuPG (GNU/Linux)  =kHPH -----END PGP SIGNATURE-----  Download attachment of type "application/octet-stream" bytes)  Download attachment of type "application/octet-stream" bytes)  Powered by blists - more mailing lists  Please check out the  Open Source Software Security Wiki, which is counterpart to this mailing list.  Confused about mailing lists and their use? Read about mailing lists on Wikipedia and check out these guidelines on proper formatting of your messages.      